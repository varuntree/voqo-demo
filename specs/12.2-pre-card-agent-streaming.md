# 12.2 - Pre-Card Agent Streaming

## Overview

This specification addresses the UX gap between clicking "Search" and seeing agency cards. Currently, users wait ~1 minute with only a static loader. This spec adds a streaming activity panel that shows the main agent's progress in real-time.

**Problem:** 1 minute of static loader = boring, feels broken

**Solution:** Stream agent activity (tool calls + brief results) below the todo panel until all N agencies are identified, then reveal cards.

---

## User Experience Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚  PHASE 1: USER INITIATES SEARCH                                                      â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Location: [Surry Hills        ]  Agencies: [====â—====] 15  [Search]           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                      â”‚
â”‚                              User clicks [Search]                                    â”‚
â”‚                                      â”‚                                               â”‚
â”‚                                      â–¼                                               â”‚
â”‚                                                                                      â”‚
â”‚  PHASE 2: AGENT STREAMING (NEW)                                                      â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         TODO PANEL                                              â”‚ â”‚
â”‚  â”‚  â— Searching for agencies in Surry Hills                                       â”‚ â”‚
â”‚  â”‚  â—‹ Processing agencies in parallel                                              â”‚ â”‚
â”‚  â”‚  â—‹ Generating demo pages                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     AGENT ACTIVITY PANEL (NEW)                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚                                                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ” Searching for real estate agencies in Surry Hills...                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ“„ Found 12 search results                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  ğŸŒ Checking Ray White Surry Hills website...                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  âœ“ Identified: Ray White Surry Hills                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  ğŸŒ Checking LJ Hooker Surry Hills website...                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  âœ“ Identified: LJ Hooker Surry Hills                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ” Searching for more agencies...                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â—â—â— (streaming indicator)                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                          â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â”‚  Found 8 of 15 agencies...                                                      â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                      â”‚
â”‚                     (No cards yet - still searching)                                 â”‚
â”‚                                                                                      â”‚
â”‚                                      â”‚                                               â”‚
â”‚                                      â–¼                                               â”‚
â”‚                                                                                      â”‚
â”‚  PHASE 3: CARDS APPEAR (After all N agencies identified)                             â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         TODO PANEL                                              â”‚ â”‚
â”‚  â”‚  âœ“ Searching for agencies in Surry Hills                                       â”‚ â”‚
â”‚  â”‚  â— Processing 15 agencies in parallel                                          â”‚ â”‚
â”‚  â”‚  â—‹ Generating demo pages                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     AGENT ACTIVITY PANEL (Collapsed/Hidden)                     â”‚ â”‚
â”‚  â”‚  â–¶ Show search activity (15 agencies found)                    [Click to expand]â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         AGENCY CARDS GRID                                       â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚  â”‚  â”‚ Ray White       â”‚ â”‚ LJ Hooker       â”‚ â”‚ Belle Property  â”‚  ...              â”‚ â”‚
â”‚  â”‚  â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘        â”‚ â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘        â”‚ â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘        â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚ â— Getting info  â”‚ â”‚ â— Getting info  â”‚ â”‚ â— Getting info  â”‚                   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Agent Activity Panel Design

### Panel States

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚  STATE 1: ACTIVE (During search)                                                     â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Agent Activity                                                                 â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â”‚  ğŸ” Searching for real estate agencies in Surry Hills...                        â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â”‚  ğŸ“„ Found 12 search results                                                     â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â”‚  ğŸŒ Checking Ray White Surry Hills...                                           â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â”‚  âœ“ Identified: Ray White Surry Hills                                            â”‚ â”‚
â”‚  â”‚     raywhitesurryhills.com.au                                                   â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â”‚  ğŸŒ Checking LJ Hooker Surry Hills...                                           â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â”‚  âœ“ Identified: LJ Hooker Surry Hills                                            â”‚ â”‚
â”‚  â”‚     ljhooker.com.au/surry-hills                                                 â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â”‚  â—â—â— â† Streaming indicator (animated dots)                                      â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚  Found 8 of 15 agencies                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                      â”‚
â”‚  STATE 2: COLLAPSED (After cards appear)                                             â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â–¶ Agent Activity  â€¢  15 agencies found  â€¢  Click to expand                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                      â”‚
â”‚  STATE 3: EXPANDED (User clicked to expand)                                          â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â–¼ Agent Activity  â€¢  15 agencies found                                         â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â”‚  (Full activity log, scrollable)                                                â”‚ â”‚
â”‚  â”‚                                                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Activity Message Types

### Message Categories

| Icon | Type | When | Example |
|------|------|------|---------|
| ğŸ” | Search | Agent uses WebSearch | "Searching for real estate agencies in Surry Hills..." |
| ğŸ“„ | Results | Search returns results | "Found 12 search results" |
| ğŸŒ | Fetch | Agent uses WebFetch | "Checking Ray White Surry Hills website..." |
| âœ“ | Identified | Agency confirmed | "Identified: Ray White Surry Hills" |
| âš ï¸ | Warning | Non-critical issue | "Skipping: Site unavailable" |
| ğŸ’­ | Thinking | Agent reasoning | "Looking for more agencies to reach 15..." |

### Message Format

```typescript
interface ActivityMessage {
  id: string;
  type: 'search' | 'results' | 'fetch' | 'identified' | 'warning' | 'thinking';
  text: string;
  detail?: string;       // Optional secondary line (e.g., website URL)
  timestamp: string;
}
```

---

## Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              STREAMING DATA FLOW                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    MAIN AGENT                    BACKEND                      FRONTEND
        â”‚                            â”‚                             â”‚
        â”‚  1. Start search           â”‚                             â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                             â”‚
        â”‚                            â”‚  2. SSE: activity_start     â”‚
        â”‚                            â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                            â”‚                             â”‚
        â”‚  3. WebSearch              â”‚                             â”‚
        â”‚     (tool call)            â”‚                             â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  4. SSE: activity_message   â”‚
        â”‚                            â”‚     type: search             â”‚
        â”‚                            â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                            â”‚                             â”‚  5. Display:
        â”‚                            â”‚                             â”‚  ğŸ” Searching...
        â”‚                            â”‚                             â”‚
        â”‚  6. Search results         â”‚                             â”‚
        â”‚     (tool response)        â”‚                             â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  7. SSE: activity_message   â”‚
        â”‚                            â”‚     type: results            â”‚
        â”‚                            â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                            â”‚                             â”‚  8. Display:
        â”‚                            â”‚                             â”‚  ğŸ“„ Found 12 results
        â”‚                            â”‚                             â”‚
        â”‚  9. WebFetch agency        â”‚                             â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  10. SSE: activity_message  â”‚
        â”‚                            â”‚      type: fetch             â”‚
        â”‚                            â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                            â”‚                             â”‚  11. Display:
        â”‚                            â”‚                             â”‚  ğŸŒ Checking...
        â”‚                            â”‚                             â”‚
        â”‚  12. Agency confirmed      â”‚                             â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  13. SSE: activity_message  â”‚
        â”‚                            â”‚      type: identified        â”‚
        â”‚                            â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                            â”‚                             â”‚  14. Display:
        â”‚                            â”‚                             â”‚  âœ“ Identified: Ray White
        â”‚                            â”‚                             â”‚
        â”‚       ... (repeat for each agency) ...                   â”‚
        â”‚                            â”‚                             â”‚
        â”‚  15. All N agencies found  â”‚                             â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  16. SSE: activity_complete â”‚
        â”‚                            â”‚      agencies: [...]         â”‚
        â”‚                            â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                            â”‚                             â”‚  17. Collapse panel
        â”‚                            â”‚                             â”‚      Show cards
        â”‚                            â”‚                             â”‚
```

---

## Implementation

### 1. Pipeline State Extension

Add to `/data/progress/pipeline-{sessionId}.json`:

```typescript
interface PipelineState {
  // ... existing fields from spec 12 ...

  // NEW: Activity log
  activity: {
    status: 'active' | 'complete';
    messages: ActivityMessage[];
    agenciesFound: number;
    agenciesTarget: number;
  };
}
```

### 2. Main Agent Updates

The main orchestrator must write activity updates to the pipeline file.

**Update orchestrator prompt (from spec 12):**

```markdown
## Activity Reporting (NEW)

You MUST report your activity to the pipeline file so users see progress.

### When using WebSearch
Before: Write activity message type "search"
After: Write activity message type "results" with count

### When checking an agency website
Before: Write activity message type "fetch" with agency name
After: Write activity message type "identified" if valid agency

### Activity Message Format
Add to pipeline file's activity.messages array:
```json
{
  "id": "msg-{timestamp}",
  "type": "search|results|fetch|identified|warning|thinking",
  "text": "Human-readable message",
  "detail": "Optional detail line",
  "timestamp": "ISO timestamp"
}
```

### Example Activity Flow

1. Starting search:
```json
{ "type": "search", "text": "Searching for real estate agencies in Surry Hills..." }
```

2. Got search results:
```json
{ "type": "results", "text": "Found 12 search results" }
```

3. Checking website:
```json
{ "type": "fetch", "text": "Checking Ray White Surry Hills website..." }
```

4. Agency confirmed:
```json
{ "type": "identified", "text": "Identified: Ray White Surry Hills", "detail": "raywhitesurryhills.com.au" }
```

5. Need more agencies:
```json
{ "type": "thinking", "text": "Looking for more agencies to reach 15..." }
```

### Update Count
After each agency identified, update:
- activity.agenciesFound = current count
- activity.agenciesTarget = requested count
```

### 3. SSE Event Types

Add new events to `/api/pipeline/stream`:

```typescript
// Activity panel started
interface ActivityStartEvent {
  type: 'activity_start';
  sessionId: string;
  target: number;    // Target agency count
}

// New activity message
interface ActivityMessageEvent {
  type: 'activity_message';
  message: ActivityMessage;
  found: number;     // Current agencies found
  target: number;    // Target count
}

// Activity complete, show cards
interface ActivityCompleteEvent {
  type: 'activity_complete';
  sessionId: string;
  agencies: Array<{
    id: string;
    name: string;
    website: string;
  }>;
}
```

### 4. Frontend Components

#### AgentActivityPanel Component

```tsx
interface AgentActivityPanelProps {
  status: 'active' | 'complete' | 'collapsed';
  messages: ActivityMessage[];
  found: number;
  target: number;
  onToggle: () => void;
}

// Features:
// - Auto-scroll to bottom as messages arrive
// - Max height with scroll for long activity
// - Animated streaming indicator (â—â—â—)
// - Collapse/expand toggle
// - Progress counter ("Found 8 of 15 agencies")
```

#### ActivityMessage Component

```tsx
interface ActivityMessageProps {
  message: ActivityMessage;
}

// Renders single message with:
// - Icon based on type
// - Main text
// - Optional detail line (dimmed)
// - Fade-in animation on appear
```

### 5. SSE Poller Updates

Modify the SSE endpoint to:

1. Watch `activity.messages` array in pipeline file
2. Track last seen message count
3. Push new messages as `activity_message` events
4. Push `activity_complete` when all agencies found

```typescript
// In SSE handler
let lastActivityCount = 0;

// On each poll
const pipeline = await readPipelineState(sessionId);
const newMessages = pipeline.activity.messages.slice(lastActivityCount);

for (const message of newMessages) {
  stream.push({
    type: 'activity_message',
    message,
    found: pipeline.activity.agenciesFound,
    target: pipeline.activity.agenciesTarget
  });
}

lastActivityCount = pipeline.activity.messages.length;

// Check if search complete
if (pipeline.activity.agenciesFound >= pipeline.activity.agenciesTarget) {
  stream.push({
    type: 'activity_complete',
    sessionId,
    agencies: pipeline.agencyIds.map(...)
  });
}
```

---

## UI Behavior

### Phase Transitions

| Phase | Activity Panel | Cards Grid |
|-------|---------------|------------|
| Search starting | Active, empty | Hidden |
| Searching | Active, messages streaming | Hidden |
| All agencies found | Collapses with animation | Appears with animation |
| Processing agencies | Collapsed (expandable) | Visible, updating |
| Complete | Collapsed (expandable) | Complete |

### Animation Specs

**Message appear:**
```css
@keyframes messageAppear {
  from {
    opacity: 0;
    transform: translateY(-5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.activity-message {
  animation: messageAppear 0.2s ease-out;
}
```

**Panel collapse:**
```css
@keyframes collapsePanel {
  from {
    max-height: 400px;
    opacity: 1;
  }
  to {
    max-height: 48px;
    opacity: 1;
  }
}

.panel-collapsing {
  animation: collapsePanel 0.3s ease-out forwards;
}
```

**Cards appear:**
```css
@keyframes cardsAppear {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.cards-grid {
  animation: cardsAppear 0.4s ease-out;
}
```

---

## Progress File Schema Update

```typescript
interface PipelineState {
  sessionId: string;
  suburb: string;
  requestedCount: number;
  status: 'searching' | 'processing' | 'complete' | 'error';
  startedAt: string;
  completedAt: string | null;

  todos: Array<{
    id: string;
    text: string;
    status: 'pending' | 'in_progress' | 'complete';
  }>;

  agencyIds: string[];

  // NEW: Activity tracking
  activity: {
    status: 'active' | 'complete';
    agenciesFound: number;
    agenciesTarget: number;
    messages: Array<{
      id: string;
      type: 'search' | 'results' | 'fetch' | 'identified' | 'warning' | 'thinking';
      text: string;
      detail?: string;
      timestamp: string;
    }>;
  };

  error?: string;
}
```

---

## Example Activity Log

```json
{
  "activity": {
    "status": "active",
    "agenciesFound": 8,
    "agenciesTarget": 15,
    "messages": [
      {
        "id": "msg-1705312200001",
        "type": "search",
        "text": "Searching for real estate agencies in Surry Hills...",
        "timestamp": "2025-01-17T14:30:00.001Z"
      },
      {
        "id": "msg-1705312200500",
        "type": "results",
        "text": "Found 12 search results",
        "timestamp": "2025-01-17T14:30:00.500Z"
      },
      {
        "id": "msg-1705312201000",
        "type": "fetch",
        "text": "Checking Ray White Surry Hills website...",
        "timestamp": "2025-01-17T14:30:01.000Z"
      },
      {
        "id": "msg-1705312202000",
        "type": "identified",
        "text": "Identified: Ray White Surry Hills",
        "detail": "raywhitesurryhills.com.au",
        "timestamp": "2025-01-17T14:30:02.000Z"
      },
      {
        "id": "msg-1705312202500",
        "type": "fetch",
        "text": "Checking LJ Hooker Surry Hills website...",
        "timestamp": "2025-01-17T14:30:02.500Z"
      },
      {
        "id": "msg-1705312203500",
        "type": "identified",
        "text": "Identified: LJ Hooker Surry Hills",
        "detail": "ljhooker.com.au/office/surry-hills",
        "timestamp": "2025-01-17T14:30:03.500Z"
      },
      {
        "id": "msg-1705312204000",
        "type": "thinking",
        "text": "Found 2 agencies, searching for more to reach 15...",
        "timestamp": "2025-01-17T14:30:04.000Z"
      }
    ]
  }
}
```

---

## File Structure Changes

### New Files

```
/components/
  â”œâ”€â”€ AgentActivityPanel.tsx     # Activity panel container
  â””â”€â”€ ActivityMessage.tsx        # Individual message display
```

### Modified Files

```
/app/page.tsx                    # Add activity panel between todo and cards
/app/api/pipeline/stream/route.ts  # Add activity event handling
/.claude/skills/agency-processor/SKILL.md  # (No change - subagent skill)

# Main orchestrator prompt (wherever defined)
# Add activity reporting instructions
```

---

## Testing Checklist

- [ ] Activity panel appears when search starts
- [ ] Messages stream in real-time
- [ ] Icons match message types
- [ ] Auto-scroll works as messages arrive
- [ ] Progress counter updates ("Found 8 of 15")
- [ ] Panel collapses when all agencies found
- [ ] Cards appear after collapse
- [ ] Collapse animation smooth
- [ ] Can expand collapsed panel
- [ ] Expanded panel shows full history
- [ ] Works with 1 agency
- [ ] Works with 25 agencies
- [ ] Handles slow searches gracefully
